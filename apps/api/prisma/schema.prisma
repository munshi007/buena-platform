generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum ManagementType {
  WEG
  MV
}

// enum UnitType {
//   APARTMENT
//   OFFICE
//   GARDEN
//   PARKING
// }

enum DocumentKind {
  TEILUNGSERKLAERUNG
  LEASE
  FLOOR_PLAN
  MAINTENANCE_RECORD
  INSURANCE_POLICY
  OTHER
}

enum PropertyStatus {
  ACTIVE
  DRAFT
}

model Property {
  id              String         @id @default(uuid())
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  name            String
  managementType  ManagementType
  status          PropertyStatus @default(ACTIVE)
  propertyNumber  String         @unique // Generated via sequence BT-000XXX
  managerId       String?
  accountantId    String?

  buildings       Building[]
  units           Unit[]
  documents       Document[]
  transactions    Transaction[]
}

model Building {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  street      String
  houseNumber String
  zipMode     String?
  city        String?

  units       Unit[]

  @@index([propertyId])
}

model Unit {
  id               String   @id @default(uuid())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  propertyId       String
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  buildingId       String
  building         Building @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  
  number           String
  type             String
  floor            String?
  entrance         String?
  
  // Decimals for precision
  size             Decimal  @db.Decimal(10, 2)
  coOwnershipShare Decimal  @db.Decimal(10, 2)
  
  constructionYear Int?
  rooms            Decimal? @db.Decimal(4, 1)

  leases           Lease[]

  @@unique([propertyId, buildingId, number])
  @@index([propertyId])
  @@index([buildingId])
}

enum LeaseStatus {
  DRAFT
  ACTIVE
  EXPIRED
  TERMINATED
}

model Tenant {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  firstName String
  lastName  String
  email     String   @unique
  phone     String?
  
  leases    Lease[]
}

model Lease {
  id            String      @id @default(uuid())
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  unitId        String
  unit          Unit        @relation(fields: [unitId], references: [id], onDelete: Cascade)
  
  tenantId      String
  tenant        Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  startDate     DateTime
  endDate       DateTime?
  rentAmount    Decimal     @db.Decimal(10, 2)
  depositAmount Decimal?    @db.Decimal(10, 2)
  status        LeaseStatus @default(ACTIVE)

  @@index([unitId])
  @@index([tenantId])
}

enum TransactionType {
  REVENUE
  EXPENSE
}

enum TransactionCategory {
  RENT
  DEPOSIT
  MAINTENANCE
  TAX
  INSURANCE
  UTILITIES
  OTHER
}

model Transaction {
  id          String              @id @default(uuid())
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  
  propertyId  String
  property    Property            @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  unitId      String?
  
  amount      Decimal             @db.Decimal(12, 2)
  type        TransactionType
  category    TransactionCategory @default(OTHER)
  date        DateTime            @default(now())
  description String?

  @@index([propertyId])
  @@index([type])
  @@index([date])
}

model Document {
  id            String            @id @default(uuid())
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  propertyId    String
  property      Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  kind          DocumentKind
  name          String
  
  versions      DocumentVersion[]

  @@index([propertyId, kind])
}

model DocumentVersion {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  
  documentId  String
  document    Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  version     Int      @default(1)
  originalName String
  mimeType      String
  sizeBytes     Int
  storageKey    String
  sha256        String?
  
  extractedData Json?

  @@index([documentId])
}
